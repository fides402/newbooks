<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Type Beat Finder</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 2rem;
      background-color: #0d0d0d;
      color: #fff;
      font-family: 'Rubik', sans-serif;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 800;
      text-align: center;
      margin-bottom: 1rem;
    }

    button {
      display: block;
      margin: 0 auto 3rem auto;
      padding: 0.8rem 2rem;
      font-size: 1.2rem;
      background-color: #e63946;
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      font-weight: 600;
    }

    .results {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
    }

    .card {
      background-color: #1a1a1a;
      border-radius: 14px;
      width: 300px;
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .card iframe {
      width: 100%;
      height: 170px;
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    .card p {
      font-size: 0.9rem;
      margin: 0.2rem 0;
      color: #ccc;
    }

    .card strong {
      color: #fff;
    }

    @media (max-width: 768px) {
      .results {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>

  <h1>Type Beat Finder</h1>
  <button onclick="fetchBeats()">Search</button>
  <div class="results" id="results"></div>

  <script>
    const API_KEY = "AIzaSyAa11smCTXwYHvGFIzwFSYkN7WBzX76fkQ";
    const KEYWORDS = [
      "larry june type beat",
      "mick jenkins type beat",
      "the alchemist type beat",
      "j cole type beat",
      "isaiah rashad type beat",
      "aaron may type beat",
      "saba type beat"
    ];

    function getTwoDaysAgoDate() {
      const now = new Date();
      now.setDate(now.getDate() - 2);
      return now;
    }

    async function fetchBeats() {
      const container = document.getElementById("results");
      container.innerHTML = "";

      const cutoff = getTwoDaysAgoDate();

      for (let keyword of KEYWORDS) {
        try {
          const searchRes = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(keyword)}&type=video&maxResults=50&order=viewCount&key=${API_KEY}`);
          const searchData = await searchRes.json();
          if (!searchData.items) continue;

          const candidates = [];

          for (const item of searchData.items) {
            const videoId = item.id.videoId;
            const statsRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${videoId}&key=${API_KEY}`);
            const statsData = await statsRes.json();
            const video = statsData.items?.[0];
            if (!video) continue;

            const publishedAt = new Date(video.snippet.publishedAt);
            const title = video.snippet.title.toLowerCase();
            const views = parseInt(video.statistics.viewCount || "0");

            if (
              publishedAt >= cutoff &&
              title.includes(keyword.toLowerCase()) &&
              views >= 2000
            ) {
              candidates.push({
                videoId,
                title: video.snippet.title,
                channel: video.snippet.channelTitle,
                views
              });
            }
          }

          if (candidates.length === 0) continue;

          candidates.sort((a, b) => b.views - a.views);
          const topVideos = candidates.slice(0, 3);

          for (let video of topVideos) {
            container.innerHTML += `
              <div class="card">
                <iframe src="https://www.youtube.com/embed/${video.videoId}" frameborder="0" allowfullscreen></iframe>
                <p><strong>${video.title}</strong></p>
                <p>üëÅÔ∏è ${video.views.toLocaleString()} views</p>
                <p>üé§ ${video.channel}</p>
              </div>
            `;
          }

        } catch (err) {
          console.error("Errore su keyword:", keyword, err);
        }
      }

      if (container.innerHTML === "") {
        container.innerHTML = "<p style='text-align:center; font-size:1.1rem;'>Nessun video trovato con almeno 2000 views negli ultimi 2 giorni.</p>";
      }
    }
  </script>

</body>
</html>
